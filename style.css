/* ====== 字体（可选）====== */
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=EB+Garamond:wght@400;500;600&family=IBM+Plex+Sans:wght@400;600&display=swap');

:root{
  --bg:#0b0d10;
  --panel:#151820;
  --ink:#e6ebf2;
  --muted:#93a1b5;
  --accent:#7aa2ff;
  --good:#28c281;
  --bad:#ff6b6b;

  /* 报纸配色 */
  --paper:#F7EDCF;
  --paper-ink:#1C2B3A;
  --paper-ink-soft:#33485f;
  --paper-rule:#C9BA8A;
  --paper-seal:#4A1D1D;
  --paper-gold:#B48A3C;
}

*{ box-sizing:border-box; }
body{
  margin:0;
  font-family: "EB Garamond", "Spectral", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial,
               "PingFang SC","Noto Sans CJK SC","Microsoft Yahei", serif;
  background:var(--bg);
  color:var(--ink);
}

/* ====== 框架 ====== */
header{
  padding:16px 20px;
  border-bottom:1px solid #222836;
  background:var(--panel);
  position:sticky; top:0; z-index:2;
}
header h1{ margin:0; font-size:18px; font-weight:600; letter-spacing:.3px; }

main{
  display:grid;
  grid-template-columns: 340px 1fr;
  gap:16px;
  padding:16px;
}
@media (max-width: 900px){ main{ grid-template-columns:1fr; } }

section{
  background:var(--panel);
  border:1px solid #222836;
  border-radius:12px;
  padding:14px;
}
h2{ margin:4px 0 12px; font-size:14px; color:var(--muted); font-weight:600; }

.field{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }

.btn{ cursor:pointer; border:none; border-radius:10px; padding:10px 14px; font-weight:600; }
.btn.primary{ background:var(--accent); color:#0b0d10; }
.btn.good{ background:var(--good); color:#0b0d10; }
.btn.bad{ background:var(--bad); color:#0b0d10; }
.btn.ghost{ background:transparent; border:1px solid #2b3347; color:var(--ink); }
.row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

.stats{ display:grid; grid-template-columns: repeat(3,1fr); gap:8px; }
.stat{ background:#0f131a; border:1px solid #222836; border-radius:10px; padding:10px; text-align:center; }
.stat .k{ font-size:12px; color:var(--muted); }
.stat .v{ font-size:18px; font-weight:700; margin-top:4px; }

.pill{
  padding:4px 8px; border:1px solid #2b3347; border-radius:999px;
  font-size:12px; color:var(--muted);
}

/* 右侧词库列表（只读） */
.list{ margin-top:8px; max-height:70vh; overflow:auto; display:flex; flex-direction:column; gap:8px; }
.item{
  background:#0f131a; border:1px solid #222836; padding:10px; border-radius:10px;
  display:flex; align-items:center; gap:10px;
}
.item:hover{ border-color:#2f3a54; }
.item .w{ font-weight:700; }
.item .n{ color:var(--muted); font-size:12px; margin-top:4px; }
.item .meta{ margin-left:auto; font-size:12px; color:var(--muted); }
.item .tag{ padding:2px 6px; border:1px solid #2b3347; border-radius:999px; font-size:11px; margin-left:6px; }

/* ====== 沉浸式遮罩与控制条 ====== */
#immersive[hidden]{ display:none; }
#immersive{ position:fixed; inset:0; z-index:9999; }
.im-mask{
  position:absolute; inset:0;
  background: radial-gradient(1200px 800px at 50% 40%, rgba(16,22,30,.88), rgba(8,10,14,.97));
  backdrop-filter: blur(4px);
}
.im-stage{
  position:relative; z-index:1; height:100%; width:100%;
  display:flex; flex-direction:column; align-items:center; justify-content:space-between;
  padding:20px 16px 28px;
}
.im-topbar{ width:min(1000px, 96vw); display:flex; align-items:center; justify-content:space-between; gap:12px; }
.im-progress{ flex:1; height:8px; background:#1b2130; border-radius:999px; overflow:hidden; border:1px solid #2b3347; }
.im-progress .bar{ height:100%; background:linear-gradient(90deg, var(--accent), #2ce4b9); }
.im-actions{ display:flex; gap:8px; }
.im-cardwrap{ flex:1; display:flex; align-items:center; justify-content:center; width:100%; transition: all .25s ease; }
.im-cardwrap.sheet-open{ align-items:flex-start; padding-top:8px; }
.im-controls{ display:flex; gap:12px; align-items:center; justify-content:center; }

/* ====== 报纸卡片（正面 + 下拉背面） ====== */
.card{
  width:min(820px, 94vw);
  height:460px;
  position:relative;
  transition: height .25s ease, transform .25s ease;
}
.card.sheet-open{
  height:100%;
  display:flex; flex-direction:column;
}

/* 双面容器（默认叠放） */
.panel{
  position:absolute; inset:0;
  border-radius:14px;
  box-shadow:0 12px 32px rgba(0,0,0,.45);
  display:flex; flex-direction:column; justify-content:center; align-items:stretch;
  opacity:0; pointer-events:none;
  transition:opacity .22s ease, transform .25s ease;
}
.card.state-front .front-panel{ opacity:1; pointer-events:auto; }
.card.state-back  .front-panel{ opacity:1; pointer-events:auto; } /* 打开时仍显示（上浮为标题） */
.card.state-back  .back-panel{ opacity:1; pointer-events:auto; }

/* 在 sheet-open 模式，面板改为顺序流式布局 */
.card.sheet-open .panel{
  position:static;
  box-shadow:none;
  border-radius:12px;
  opacity:1; pointer-events:auto;
}

/* 报纸纸张主体（正/背共用） */
.paper{
  position:relative;
  background: var(--paper);
  border:1px solid var(--paper-rule);
  border-radius:12px;
  color: var(--paper-ink);
  overflow:hidden;
  padding:18px 20px 16px;
  background-image:
    radial-gradient( rgba(0,0,0,.035) 1px, transparent 1.5px ),
    linear-gradient(0deg, rgba(255,255,255,.35), rgba(255,255,255,0)),
    linear-gradient(90deg, #efe2bf 0%, #f7edcf 35%, #f7edcf 65%, #efe2bf 100%);
  background-size: 3px 3px, 100% 100%, 100% 100%;
}
.paper::before{
  content:"";
  position:absolute; inset:-2px;
  background:
    radial-gradient(800px 260px at 50% 0%, rgba(0,0,0,.15), rgba(0,0,0,0) 60%),
    radial-gradient(1200px 800px at 50% 100%, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
  pointer-events:none;
}
.paper::after{
  content:"";
  position:absolute; inset:0;
  background: repeating-linear-gradient(0deg, rgba(0,0,0,.03) 0, rgba(0,0,0,.03) 1px, transparent 2px);
  mix-blend-mode:multiply; opacity:.5; pointer-events:none;
}

/* 正面：报头与大标题（保持原样） */
.masthead{
  display:flex; align-items:center; justify-content:space-between;
  border-bottom:1px solid var(--paper-rule);
  padding-bottom:8px; margin-bottom:10px;
}
.mast-left{
  font-family:"Cormorant Garamond", serif;
  font-weight:700; letter-spacing:.06em; text-transform:uppercase;
  color:#0E1116; font-size:18px;
}
.mast-right{
  font-family:"IBM Plex Sans", sans-serif;
  color:var(--paper-ink-soft); font-size:12px; display:flex; gap:10px; align-items:center;
}
.headline{
  font-family:"Cormorant Garamond", serif;
  font-weight:700;
  font-size: clamp(30px, 6.2vw, 54px);
  letter-spacing:.02em;
  line-height:1.05;
  margin:8px 0 4px;
}
.headline.sc{ font-variant: small-caps; }
.subhead{
  font-style:italic; color:var(--paper-ink-soft);
  font-size:16px; line-height:1.5; margin-bottom:8px;
}
.seals{
  display:flex; gap:10px; align-items:center; margin-top:6px;
}
.seal{
  font-family:"IBM Plex Sans", sans-serif;
  font-weight:600; font-size:12px; letter-spacing:.06em;
  color:#fff; background:var(--paper-seal);
  border-radius:999px; padding:4px 10px;
  box-shadow: inset 0 -1px 0 rgba(255,255,255,.15), 0 2px 6px rgba(0,0,0,.25);
}
.footer-rule{ border-top:1px solid var(--paper-rule); margin-top:10px; padding-top:8px; }
.ink { text-shadow: 0 .02em .02em rgba(0,0,0,.15); }

/* —— 上浮为标题（收缩样式）—— */
.card.sheet-open .front-panel{ transform: translateY(-8px); }
.card.sheet-open .front-panel .paper{
  padding:10px 14px; border-radius:12px;
  box-shadow: 0 6px 16px rgba(0,0,0,.25);
}
.card.sheet-open .headline{ font-size: clamp(22px, 3.6vw, 32px); margin:4px 0 2px; }
.card.sheet-open .subhead{
  font-size:14px; margin-bottom:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.card.sheet-open .masthead{ padding-bottom:6px; margin-bottom:6px; }
.card.sheet-open .seal{ padding:3px 8px; font-size:11px; }

/* 背面：下拉内容占满纵向，主体滚动 */
.back-panel{ margin-top:10px; }
.card.sheet-open .back-panel{ animation: drop-open .25s ease-out; }
.card.sheet-open .back-panel .paper{ display:flex; flex-direction:column; height:100%; }
.card.sheet-open .paper-body{
  display:grid;
  grid-template-columns: repeat(2, minmax(260px, 1fr));
  gap:16px 18px;
  padding-top:6px;
  flex:1 1 auto;
  min-height:0;           /* 关键：让子元素可以滚动 */
  overflow-y:auto;
}
@media (max-width:720px){ .card.sheet-open .paper-body{ grid-template-columns:1fr; } }

/* 背面“文章模块” */
.article{ padding:6px 8px 8px; position:relative; }
.article .label{
  font-family:"IBM Plex Sans", sans-serif;
  font-weight:600; font-size:12px; letter-spacing:.04em;
  color:#6a5a2f; margin-bottom:6px;
}
.article .text{ color:#2b3b4e; font-size:15px; line-height:1.6; }
.article .capsule{
  display:inline-block; padding:2px 8px; margin:2px 6px 2px 0;
  font-size:12px; border:1px solid #cdbf96; border-radius:999px; color:#233043; background:#fff8e7;
}
.article .tags .pill{
  padding:4px 8px; border:1px dashed #b89f67; color:#3b2e1c; background:#fff7de; border-radius:8px;
  display:inline-block; margin:2px 6px 2px 0; transform:rotate(-1.5deg);
}
.article.warning{
  border:1px solid #b57d7d; background:#fff1f1; border-radius:8px; padding:8px;
}
.article.warning .label{ color:#7a2a2a; }
.news-ol{ margin:6px 0 0 18px; padding:0; }
.news-ol li{ margin:4px 0; padding-left:2px; }

/* 小动画 */
@keyframes drop-open{
  from{ opacity:0; transform: translateY(-10px); }
  to{ opacity:1; transform: translateY(0); }
}

/* —— 修复收合重影：两段式关闭 —— */

/* 1) 打开状态下禁用面板的过度动画，避免类名切换时的双重绘制 */
.card.sheet-open .panel{ transition: none; }

/* 2) 背面内容默认有一个很大的 max-height，便于后续做高度动画 */
.card.sheet-open .back-panel .paper-body{
  max-height: 9999px;
  overflow: auto;
}

/* 3) 进入 closing 阶段：只让背面正文做收合动画 */
.card.closing .back-panel .paper-body{
  overflow: hidden;
  transition: max-height .25s ease, opacity .2s ease;
  /* JS 会把 max-height 先设成实际高度，再改为 0 触发动画 */
}

/* 4) 可选：在关闭阶段同时淡出一点，观感更干净 */
.card.closing .back-panel .paper-body{ opacity: 0; }

/* 5)（可选）给两个面板一个稳定的合成层，减少闪烁 */
.front-panel, .back-panel{ will-change: transform, opacity; transform: translateZ(0); }
